var ARICH=ARICH||{};ARICH.composer={};ARICH.composer=function(){var _order=0;var _resetOrder=function(){_order=0};var _beforeScript=function(e,t){try{var n=t||0;if(!ARICH.queue.isBlocked()){if(ARICH.queue.triggerExecution(e)){if(ARICH.queue.setExecute(e)){ARICH.queue.blocked();_rumScript()}else{console.log("[ARICH.composer._beforeScript] KEY_ACTION informada não conseguiu ser setada para execução | KEY_ACTION = "+e)}}else{console.log("[ARICH.composer._beforeScript] KEY_ACTION informada não existe | KEY_ACTION = "+e)}}else{if(n<ARICH.config.get("sys_attempts_beforeExecute")){setTimeout(function(){_beforeScript(e,n+1)},ARICH.config.get("sys_timeout_beforeExecute"))}else{console.log("[ARICH.composer._beforeScript] Limite de tentativas de execução foi excedido | KEY_ACTION = "+e)}}}catch(r){console.log("[ARICH.composer._beforeScript] Erro geral: "+r.message)}};var _rumScript=function(){try{var queue=ARICH.queue.getQueueExecute(_order),i;for(i=0;i<queue.length;i++){try{var func=_discoveryFunctionExecute(queue[i]["function_exec"]);var params=[];if(queue[i]["params"]!=undefined){var item_bruto=ARICH.helper.page.getCache(queue[i]["params"]);var items=item_bruto.split("|"),j;for(j=0;j<items.length;j++){if(items[j].search("%%")<0){params.push(eval(items[j]))}else{var newObj=ARICH.composer.cache.load(eval(items[j].match(/[0-9]+/)[0]));if(items[j].search("[.]")>=0){var subItens=items[j].split(".");var h;for(h=1;h<subItens.length;h++){newObj=newObj[subItens[h]]}}params.push(newObj)}}}if(queue[i]["remote"]){params.push(queue[i]["id"])}func.apply(null,params);if(!queue[i]["remote"]){ARICH.queue.alterQueueExecute({status:"ok"},"id",queue[i]["id"])}}catch(e){ARICH.queue.alterQueueExecute({status:"fail"},"id",queue[i]["id"]);ARICH.queue.errorQueueExecute("ID Queue: "+queue[i].id.toString()+" | "+e.message+" | "+e.name+" | "+e.lineNumber+" | "+e.fileName)}}_afterScript()}catch(e){console.log("[ARICH.composer._rumScript] Erro geral: "+e.message)}};var _afterScript=function(){try{if(arguments[0]!==undefined){ARICH.composer.cache.insert({data:arguments[0],status:arguments[1],metadata:arguments[2],id_exec:arguments[3]});ARICH.queue.alterQueueExecute({status:"ok"},"id",arguments[3])}else{if(!ARICH.queue.errorInExecution()){if(!ARICH.queue.hasExecute(_order)){if(ARICH.queue.hasExecute(_order+1)){_order++;_rumScript()}else{ARICH.queue.resetQueueExecute();ARICH.composer.cache.clear();_order=0}}else{setTimeout(ARICH.composer.afterScript,1e3)}}else{ARICH.helper.page.message("Foi encontrado erros no processo solicitado.","error");console.log("[ARICH.composer._afterScript] Foi encontrado erros na execução da fila");ARICH.queue.resetQueueExecute();ARICH.composer.cache.clear();_order=0;ARICH.helper.modal.hide()}}}catch(e){console.log("[ARICH.composer._afterScript] Erro geral: "+e.message)}};var _discoveryFunctionExecute=function(e){var t=e.split("."),n,r=window;for(n=0;n<t.length;n++){if(typeof r[t[n]]!=="undefined"){r=r[t[n]]}else{r=null;break}}return r};return{beforeScript:_beforeScript,rumScript:_rumScript,afterScript:_afterScript,resetOrder:_resetOrder}}();ARICH.composer.cache=function(){var e=[];return{insert:function(t){e.push({data:t.data,status:t.status,metadata:t.metadata,id:t.id_exec})},load:function(t){var n=ARICH.helper.hashtable.find(e,{id:t});if(n!==undefined){return n.data}else{return[]}},remove:function(t){e=ARICH.helper.hashtable.remove(e,"id",t)},clear:function(){e=[]},internalCache:e}}()