var ARICH=ARICH||{};ARICH.helper={};ARICH.helper.ajax=function(data,id_execute){function _returnWithParameters(data_return,textStatus,data,id_execute){if(textStatus=="success"){var callback=eval(data["function_return"]);if(typeof callback!="undefined"){callback(data_return,textStatus,data,id_execute)}else{console.log("[ARICH.helper.ajax] Sucesso no envio das informações, porem a função de retorno não existe ou não é válida! | function_return = "+data["function_return"])}}else{ARICH.queue.alterQueueExecute({status:"fail"},"id",id_execute);ARICH.queue.errorQueueExecute("ID Queue: "+id_execute.toString());var callback=eval(data["function_return_error"]);if(typeof callback!="undefined"){callback(data_return,textStatus,data,id_execute)}else{if(data_return.statusText.trim()=="Unauthorized"){ARICH.queue.resetQueueExecute();ARICH.composer.beforeScript("initialize_login_main")}else{ARICH.helper.page.message("Erro ao conectar com o servidor","error");console.log("[ARICH.helper.ajax] ERRO no retorno, porém a função de para tratar erros não existe! | textStatus = "+textStatus+" | statusCode = "+data_return.statusCode());ARICH.queue.resetQueueExecute();ARICH.helper.modal.hide()}}}}var parms=ARICH.helper.resolverPath(data["remote_element"],data["remote_action"],data["remote_id"],data["remote_custon_url"]);var localData=typeof data["remote_data"]!="undefined"?jQuery.param(data["remote_data"]):null;$.ajax({url:parms["url"],type:parms["verb"],crossDomain:true,data:localData}).fail(function(e,t,n){console.log("[ARICH.helper.ajax] Erro: "+n);_returnWithParameters(e,t,data,id_execute)}).done(function(e,t){_returnWithParameters(e,t,data,id_execute)})};ARICH.helper.resolverPath=function(e,t,n,r){var i;switch(t){case"insert":i={url:ARICH.config.get("sys_remote_path")+e+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:"post",verb:"POST"};break;case"update":i={url:ARICH.config.get("sys_remote_path")+e+"/"+n+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:"post",verb:"PUT"};break;case"delete":i={url:ARICH.config.get("sys_remote_path")+e+"/"+n+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:"post",verb:"DELETE"};break;case"show":i={url:ARICH.config.get("sys_remote_path")+e+"/"+n+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:"get",verb:"GET"};break;case"all":i={url:ARICH.config.get("sys_remote_path")+e+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:"get",verb:"GET"};break;case"custon":i={url:ARICH.config.get("sys_remote_path")+r["url"]+"?company_id="+ARICH.config.get("company_id")+"&token="+ARICH.helper.cookie.getCookie(),url_method:r["url_method"],verb:r["verb"]};break}return i};ARICH.helper.page={};ARICH.helper.page.setAction=function(obj){var j;for(j=0;j<obj.length;j++){if(obj[j].func===undefined){$(obj[j].element).bind(obj[j].event,ARICH.config.get("func_event_default"))}else{$(obj[j].element).bind(obj[j].event,eval(obj[j].func))}}};ARICH.helper.page.setKeyEnter=function(e){if(e.which==13){ARICH.helper.page.callCompose(e)}};ARICH.helper.page.callCompose=function(e){var t=ARICH.helper.page.getValidNode(e,"id");ARICH.composer.beforeScript(t["id"])};ARICH.helper.page.executeJS=function(){var e;try{for(e=0;e<arguments[0].length;e++){arguments[0][e]()}}catch(t){console.log("[ARICH.helper.page.executeJS] ERRO ao executar a função = "+arguments[0][e],toString)}};ARICH.helper.page.getValidNode=function(e,t,n){var r=ARICH.helper.page.getElement(e);if(r[t]==""&&r.nodeName!="#document"){return ARICH.helper.page.getValidNode(r.parentNode,t,n)}else{if(n!==undefined&&r.nodeName!="#document"){if(r[t]!=n){return ARICH.helper.page.getValidNode(r.parentNode,t,n)}else{return r}}else{return r}}};ARICH.helper.page.setCacheIDFromTable=function(){var e=ARICH.helper.page.getValidNode(this,"id","row_edit");ARICH.helper.cache.insert("row_id",$(e).find("#row_id").val())};ARICH.helper.page.setCacheIDLayer=function(){ARICH.helper.cache.insert("layer_id",this.value)};ARICH.helper.page.getElement=function(e){e=e||window.event;var t=e.target||e.srcElement;if(typeof t=="undefined"){t=e}else{if(t.nodeType==3){t=t.parentNode}}return t};ARICH.helper.page.create=function(e,t,n){switch(n){case"overwrite":$(e).html(t);break;case"before":$(e).before(t);break;case"after":$(e).after(t);break;default:$(e).append(t);break}};ARICH.helper.page.createM=function(e,t,n,r){switch(r){case"overwrite":$(e).html(Mustache.to_html(t,n));break;case"before":$(e).before(Mustache.to_html(t,n));break;case"after":$(e).after(Mustache.to_html(t,n));break;default:$(e).append(Mustache.to_html(t,n));break}};ARICH.helper.page.sendData=function(e,t){function n(t,n){switch(n){case"text":return $("#"+t).val();break;case"date":break;case"checkbox":return $("#"+t).is(":checked");break;case"cache":return ARICH.helper.cache.load(t);break;case"combobox":break;case"botton":return $("#"+t).text();break;case"image":break;case"file":break;default:console.log("[ARICH.helper.page.getData._stractData] Não foi possível achar o tipo de dado informado (type = '"+e[r].structure[t].type+"')");return"";break}}var r,i,s={};for(r=0;r<e.length;r++){if(typeof e[r].entity!="undefined"){s[e[r].entity]={};for(i in e[r].structure){s[e[r].entity][e[r].structure[i].server_field]=n(i,e[r].structure[i].type)}}else{for(i in e[r].structure){s[e[r].structure[i].server_field]=n(i,e[r].structure[i].type)}}ARICH.helper.ajax({remote_data:s,remote_element:e[r].element,remote_action:e[r].action,remote_id:e[r].id,function_return:e[r].function_return||"ARICH.composer.afterScript",function_return_error:e[r].function_return_error||"ARICH.helper.page.notifyError"},t)}};ARICH.helper.page.getCache=function(e,t){if(typeof e=="string"){if(e.search("##")>=0){var n=e.match(/##\w+##/)[0];n=n.replace(/#/gi,"");var r=ARICH.helper.cache.load(n);e=e.replace(/##\w+##/,r)}}else if(e instanceof Array){var i;for(i=0;i<e.length;i++){e[i]=ARICH.helper.page.getCache(e[i])}}else{var s;for(s in e){if(!(e[s]instanceof Number&&e[s]instanceof Date)){e[s]=ARICH.helper.page.getCache(e[s])}}}return e};ARICH.helper.page.notifyError=function(e,t,n,r){ARICH.helper.page.message("Um erro ocorreu ao enviar dado para o servidor. Cheque suas conexões com a internet ou seus dados de autenticação.","error");console.log("[ARICH.helper.page.notifyErro] ERRO no retorno do servidor!| ID Queue: "+r.toString()+" | textStatus = "+t);ARICH.queue.resetQueueExecute();ARICH.helper.modal.hide()};ARICH.helper.page.message=function(e,t){var n="";switch(t){case"error":n+='<div class="alert alert-error">';n+='<button type="button" class="close" data-dismiss="alert">×</button>';n+="<strong>Erro!</strong> "+e;n+="</div>";break;case"sucess":n+='<div class="alert alert-success">';n+='<button type="button" class="close" data-dismiss="alert">×</button>';n+="<strong>Sucesso!</strong> "+e;n+="</div>";break;case"info":n+='<div class="alert alert-info">';n+='<button type="button" class="close" data-dismiss="alert">×</button>';n+="<strong>Informativo</strong> "+e;n+="</div>";break;default:n+='<div class="alert">';n+='<button type="button" class="close" data-dismiss="alert">×</button>';n+="<strong>Aviso!</strong> "+e;n+="</div>";break}if($("#alert-message").length>0){$("#alert-message").html(n)}else{$("body").html(n)}};ARICH.helper.page.date=function(e){$(e).datepicker({dayNames:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"],dayNamesMin:["D","S","T","Q","Q","S","S","D"],dayNamesShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb","Dom"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],monthNamesShort:["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],nextText:"Próximo",prevText:"Anterior",minDate:+1})};ARICH.helper.page.attSelect2=function(e,t){$(e).select2("val",t)};ARICH.helper.json={};ARICH.helper.json.toJSON=function(e){var t;if(e!=""||typeof e!="undefined"){t=JSON.stringify(e)}else{t=""}return t};ARICH.helper.json.toObject=function(e){try{if(e!==null){var t=e.replace(/'/g,'"');return JSON.parse(t)}else{return""}}catch(n){console.log("[ARICH.helper.json.toObject] Erro ao executar o PARSE: "+n.message)}};ARICH.helper.fusiontable={};ARICH.helper.fusiontable.structure=function(e,t){var n=["https://www.googleapis.com/fusiontables/v1/tables/"];n.push(e);n.push("/columns?key="+ARICH.config.get("google_api_key"));var r;$.ajax({type:"GET",dataType:"jsonp",url:n.join(""),success:function(e){t(e)},error:function(e,t,n){ARICH.helper.page.message("Erro na tentativa de obter a estrutura da tabela","error");console.log("[ARICH.helper.fusiontable.structure] Erro obter a estrutura de uma tabela: "+n)}});return r};ARICH.helper.fusiontable.createLayer=function(e){var t=[new OpenLayers.Strategy.Fixed];if(e.geometry_type==0){t.push(new OpenLayers.Strategy.Cluster({distance:ARICH.config.get("layer_default_cluster_distance"),threshold:ARICH.config.get("layer_default_cluster_threshold")}))}var n=new OpenLayers.Layer.Vector(e.name,{projection:new OpenLayers.Projection(ARICH.config.get("maps_projection_default")),strategies:t,protocol:new OpenLayers.Protocol.Script({url:"https://www.googleapis.com/fusiontables/v1/query",params:{sql:"select * from "+e.worktable_name,key:ARICH.config.get("google_api_key")},format:new OpenLayers.Format.GeoJSON({ignoreExtraDims:true,read:function(t){var n,r,i={},s=[];var o=t.columns;for(var u=0;u<t.rows.length;u++){n=t.rows[u];r=new OpenLayers.Feature.Vector;i={};for(var a=0;a<n.length;a++){if(o[a]==e.geometry_field){r.geometry=this.parseGeometry(n[a].geometry)}else{i[o[a]]=n[a]}}r.attributes=i;if(r.geometry){s.push(r)}}ARICH.helper.modal.hide();return s}})})});if(e.geometry_type==0){var r=new OpenLayers.Style({pointRadius:ARICH.config.get("layer_default_point_radius"),graphicWidth:ARICH.config.get("layer_default_graphic_width"),externalGraphic:"${external_grafic}",label:"${label}"},{context:{label:function(t){if(e.label.length>1){if(typeof t.cluster!="undefined"){if(t.cluster.length>1){return t.cluster.length}else{return t.cluster[0].attributes[e.label]}}else{return t.attributes[e.label]}}},external_grafic:function(t){if(typeof t.cluster=="undefined"){return e.external_graphic||ARICH.config.get("layer_default_external_graphic")}else{return ARICH.config.get("layer_default_cluster_graphic")}}}});if(e.label.length>1){r.defaultStyle.labelAlign=ARICH.config.get("layer_labelAlign_default");r.defaultStyle.labelOutlineColor=ARICH.config.get("layer_labelOutlineColor_default");r.defaultStyle.labelOutlineWidth=ARICH.config.get("layer_labelOutlineWidth_default");r.defaultStyle.fontWeight=ARICH.config.get("layer_fontWeight_default");r.defaultStyle.fontFamily=ARICH.config.get("layer_fontFamily_default");r.defaultStyle.fontSize=ARICH.config.get("layer_fontSize_default")}}else{var r=new OpenLayers.Style;r.defaultStyle.fillColor=e.fill_color||ARICH.config.get("layer_default_fill_color");r.defaultStyle.strokeColor=e.outline_color||ARICH.config.get("layer_default_outline_color");r.defaultStyle.fillOpacity=e.fill_opacity||ARICH.config.get("layer_default_fill_opacity");if(e.label.length>1){r.label="${label}";r.defaultStyle.labelAlign=ARICH.config.get("layer_labelAlign_default");r.defaultStyle.labelOutlineColor=ARICH.config.get("layer_labelOutlineColor_default");r.defaultStyle.labelOutlineWidth=ARICH.config.get("layer_labelOutlineWidth_default");r.defaultStyle.fontWeight=ARICH.config.get("layer_fontWeight_default");r.defaultStyle.fontFamily=ARICH.config.get("layer_fontFamily_default");r.defaultStyle.fontSize=ARICH.config.get("layer_fontSize_default")}}n.styleMap=new OpenLayers.StyleMap({"default":r});e.ol_id=n.id;ARICH.helper.layer.cache.insert(e);if(n.CLASS_NAME.indexOf("Vector")>0){var i=new OpenLayers.Control.SelectFeature(n,{multiple:false,toggle:true});ARICH.helper.maps.defaultMap.addControl(i);i.activate();n.events.register("featureselected",null,ARICH.helper.maps.defaultMap.selectedFeature)}ARICH.helper.maps.defaultMap.addLayer(n)};ARICH.helper.maps={};ARICH.helper.maps.before_initialise=function(){var e=["http://maps.googleapis.com/maps/api/js"];e.push("?v="+ARICH.config.get("google_maps_version"));e.push("&sensor="+ARICH.config.get("google_maps_sensor"));e.push("&key="+ARICH.config.get("google_api_key"));e.push("&language="+ARICH.config.get("google_maps_language"));e.push("&callback=ARICH.helper.maps.initialise");var t=document.createElement("script");t.type="text/javascript";t.src=e.join("");document.head.appendChild(t)};ARICH.helper.maps.initialise=function(){ARICH.helper.maps.defaultMap=new OpenLayers.Map(ARICH.config.get("element_map_default"),{controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.ScaleLine]});var gmap=new OpenLayers.Layer.Google("Google Maps",{type:eval(ARICH.config.get("google_maps_default_maptype"))});ARICH.helper.maps.defaultMap.addLayer(gmap);ARICH.helper.maps.defaultMap.setCenter((new OpenLayers.LonLat(ARICH.config.get("google_maps_default_location_y"),ARICH.config.get("google_maps_default_location_x"))).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),ARICH.config.get("google_maps_default_zoom"));ARICH.helper.maps.defaultMap.selectedFeature=function(e){var t=ARICH.helper.layer.cache.load(e.feature.layer.id,"ol_id");var n="";if(t.fields_show){n+="<br>";var r=t.fields_show.split(";");for(var i=0;i<r.length;i++){var s=r[i].split("&");for(var o in e.feature.attributes){if(o==s[0]){n+="<strong>"+s[1]+": </strong>";n+=e.feature.attributes[o]+"<br>"}}}}else{n+="Não há dados disponíveis"}ARICH.helper.maps.defaultMap.addPopup(new OpenLayers.Popup.FramedCloud("popup",new OpenLayers.LonLat(e.feature.geometry.getCentroid().x,e.feature.geometry.getCentroid().y),null,n,null,true))}};ARICH.helper.layer={};ARICH.helper.layer.create=function(e){};ARICH.helper.layer.load=function(e){var t,n=e.length;for(t=0;t<n;t++){ARICH.helper.layer.cache.insert(e[t])}if(arguments[3]!==undefined){ARICH.queue.alterQueueExecute({status:"ok"},"id",arguments[3])}};ARICH.helper.layer.visibility=function(e){var t=ARICH.helper.layer.cache.load(parseInt(e)),n,r=ARICH.helper.maps.defaultMap.layers.length,i=false;for(n=0;n<r;n++){if(ARICH.helper.maps.defaultMap.layers[n].id==t.ol_id){if(ARICH.helper.maps.defaultMap.layers[n].visibility){ARICH.helper.maps.defaultMap.layers[n].setVisibility(false)}else{ARICH.helper.maps.defaultMap.layers[n].setVisibility(true)}i=true}}if(!i){ARICH.helper.fusiontable.createLayer(t)}else{ARICH.helper.modal.hide()}};ARICH.helper.layer.simplify=function(e,t){};ARICH.helper.layer.cache=function(){var e=[];return{insert:function(t){var n,r=false;for(n=0;n<e.length;n++){if(e[n]["id"]==t.id){e[n]=t;r=true}}if(!r){t.date=new Date;t.ol_id=0;e.push(t)}},load:function(t,n){var r;if(n){var i={};i[n]=t;r=ARICH.helper.hashtable.find(e,i)}else{r=ARICH.helper.hashtable.find(e,{id:t})}return r},remove:function(t){e=ARICH.helper.hashtable.remove(e,"id",t)},clear:function(){e=[]},all:function(){return e},internalCache:e}}();ARICH.helper.hashtable={};ARICH.helper.hashtable.exist=function(e,t,n){var r=ARICH.helper.hashtable.slice(e,t,n);return r.length>0};ARICH.helper.hashtable.find=function(e,t,n){var r=ARICH.helper.hashtable.slice(e,t,n);if(r.length>0){return r[0]}else{return{}}};ARICH.helper.hashtable.remove=function(e,t,n){var r=[],i;for(i=0;i<e.length;i++){if(e[t]!==undefined){if(e[i][t]!=n){r.push(e[i])}}}return r};ARICH.helper.hashtable.count=function(e,t,n){return ARICH.helper.hashtable.slice(e,t,n).length};ARICH.helper.hashtable.slice=function(e,t,n){var r=[],i=n||"and";if(t!==null){switch(i){case"and":var s="";for(s in t){if(typeof e!=="undefined"){if(r.length==0){var o;for(o=0;o<e.length;o++){if(e[o][s]==t[s]){r.push(e[o])}}if(r.length==0){break}}else{var o,u=[];for(o=0;o<r.length;o++){if(r[o][s]==t[s]){u.push(r[o])}}r=u;if(u.length==0){r=[];break}}}else{console.log("[ARICH.helper.hashtable.slice] Hash table não informada");r=[]}}break;case"or":var a=[];var f;for(f=0;f<e.length;f++){a.push(e[f])}if(typeof e!=="undefined"){for(var s in t){var o;for(o=0;o<a.length;o++){if(a[o][s]==t[s]){var l=[];for(var f=0;f=a.length;f++){if(f!=o){l.push(a[f])}}a=l}}}}else{console.log("[ARICH.helper.hashtable.slice] Hash table não informada");r=[]}break}}else{r=e}return r};ARICH.helper.cookie=function(e,t){switch(t){case"set":if(typeof e!="undefined"){var n;for(n in e){if(e.hasOwnProperty(n)){$.cookie(n,e[n],{expires:ARICH.config.get("cookie_expirate_day")})}}ARICH.helper.cookie.redirect()}else{ARICH.composer.beforeScript("login")}break;case"delete":var r=$.cookie(),n;for(n in r){if(r.hasOwnProperty(n)){$.removeCookie(n)}}ARICH.composer.beforeScript("login");break;default:console.log("[ARICH.helper.page.authentication] O tipo de ação informada não existe");ARICH.composer.beforeScript("login");break}};ARICH.helper.cookie.setCookie=function(e){ARICH.helper.cookie({token:e},"set")};ARICH.helper.cookie.getCookie=function(){return $.cookie("token")||""};ARICH.helper.cookie.redirect=function(){if(window.location.pathname.match(/index-adm/gi)!=null){ARICH.composer.beforeScript("initialize_adm_main")}else{ARICH.composer.beforeScript("initialize_client_main")}};ARICH.helper.cookie.getAllCookie=function(){return $.cookie()||""};ARICH.helper.modal={};ARICH.helper.modal.show=function(e){var t=$("<ul/>").addClass("arich-modal-ul");if(typeof e!=="undefined"){var n,r=e.length;for(n=0;n<r;n++){var i=$("<li/>");i.append(e[n]);t.append(i)}}else{i.append("Aguarde por favor.");t.append(i)}$("#dialog-message").html(t);$("#dialog-message").dialog({title:ARICH.config.get("modal_title"),modal:true,closeOnEscape:false,draggable:ARICH.config.get("modal_draggable")});$("#dialog-message").dialog("widget").find(".ui-dialog-titlebar-close").hide()};ARICH.helper.modal.hide=function(){$("#dialog-message").dialog("close")};ARICH.helper.cache=function(){var e=[];return{insert:function(t,n){var r,i,s=false;for(r=0;r<e.length;r++){if(e[r]["name"]==t){e[r]["value"]=n;s=true}}if(!s){e.push({name:t,value:n,date:new Date})}},load:function(t){var n=ARICH.helper.hashtable.find(e,{name:t});return n.value},remove:function(t){e=ARICH.helper.hashtable.remove(e,"name",t)},clear:function(){e=[]},internalCache:e}}()